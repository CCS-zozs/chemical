<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Markdown 转 HTML 实时转换器</title>

    <!-- 引入 Tailwind CSS for styling -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- 引入 marked.js for Markdown to HTML conversion -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
      /* 自定义样式，用于美化渲染后的 HTML 输出 */
      .rendered-html h1,
      .rendered-html h2,
      .rendered-html h3,
      .rendered-html h4,
      .rendered-html h5,
      .rendered-html h6 {
        border-bottom: 1px solid #e2e8f0;
        padding-bottom: 0.3em;
        margin-top: 1.5em;
        margin-bottom: 1em;
      }
      .rendered-html h1 {
        font-size: 2em;
        font-weight: 600;
      }
      .rendered-html h2 {
        font-size: 1.5em;
        font-weight: 600;
      }
      .rendered-html h3 {
        font-size: 1.25em;
        font-weight: 600;
      }
      .rendered-html p {
        margin-bottom: 1em;
        line-height: 1.6;
      }

      /* 列表样式 */
      .rendered-html ul,
      .rendered-html ol {
        list-style-position: inside;
        padding-left: 1em;
        margin-bottom: 1em;
      }
      .rendered-html ul {
        list-style-type: disc;
      }
      .rendered-html ol {
        list-style-type: decimal;
      }
      .rendered-html ul ul,
      .rendered-html ol ol,
      .rendered-html ul ol,
      .rendered-html ol ul {
        margin-left: 1.5em;
      }
      .rendered-html li {
        margin-bottom: 0.5em;
      }

      .rendered-html blockquote {
        border-left: 4px solid #a0aec0;
        padding-left: 1em;
        margin-left: 0;
        color: #4a5568;
        font-style: italic;
      }
      .rendered-html pre {
        background-color: #1a202c;
        color: #e2e8f0;
        padding: 1em;
        border-radius: 0.5rem;
        overflow-x: auto;
        margin-bottom: 1em;
      }
      .rendered-html code {
        background-color: #edf2f7;
        color: #2d3748;
        padding: 0.2em 0.4em;
        border-radius: 0.25rem;
        font-family: monospace;
      }
      .rendered-html pre code {
        background-color: transparent;
        padding: 0;
      }
      .rendered-html table {
        width: 100%;
        border-collapse: collapse;
        margin-bottom: 1em;
      }
      .rendered-html th,
      .rendered-html td {
        border: 1px solid #cbd5e0;
        padding: 0.5em 0.75em;
      }
      .rendered-html th {
        background-color: #f7fafc;
      }
      .rendered-html a {
        color: #3182ce;
        text-decoration: none;
      }
      .rendered-html a:hover {
        text-decoration: underline;
      }
      /* 激活标签的样式 */
      .tab-active {
        background-color: white;
        box-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
      }
    </style>
  </head>
  <body class="bg-gray-100 font-sans">
    <div class="container mx-auto p-4">
      <header class="text-center mb-8">
        <h1 class="text-4xl font-bold text-gray-800">Markdown 实时转换器</h1>
        <p class="text-gray-600 mt-2">
          在左侧输入 Markdown，在右侧即时查看 HTML 预览或源码。
        </p>
      </header>

      <main class="flex flex-col md:flex-row gap-4 h-[calc(100vh-150px)]">
        <!-- 左侧：Markdown 输入 -->
        <div class="w-full md:w-1/2 h-full flex flex-col">
          <h2 class="text-xl font-semibold mb-2 text-gray-700">
            Markdown 输入
          </h2>
          <textarea
            id="markdown-input"
            class="w-full h-full p-4 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out resize-none bg-white"
            placeholder="在这里输入你的 Markdown..."
          ></textarea>
        </div>

        <!-- 右侧：输出区域 (预览/HTML源码) -->
        <div class="w-full md:w-1/2 h-full flex flex-col">
          <!-- 新增：切换标签 -->
          <div class="flex justify-between items-center mb-2">
            <div class="flex space-x-1 rounded-lg bg-gray-200 p-1">
              <button
                id="preview-btn"
                class="px-3 py-1 text-sm font-medium rounded-md transition-colors"
              >
                预览
              </button>
              <button
                id="source-btn"
                class="px-3 py-1 text-sm font-medium rounded-md transition-colors"
              >
                HTML
              </button>
            </div>
          </div>

          <!-- 输出内容的容器 -->
          <div class="relative w-full h-full">
            <!-- HTML 预览 -->
            <div
              id="html-output"
              class="w-full h-full p-4 border border-gray-300 rounded-lg shadow-sm bg-white overflow-y-auto rendered-html"
            ></div>

            <!-- 新增：HTML 源码视图 -->
            <div id="source-view" class="hidden w-full h-full relative">
              <textarea
                id="html-source-output"
                readonly
                class="w-full h-full p-4 border border-gray-300 rounded-lg shadow-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out resize-none bg-gray-800 text-white font-mono text-sm"
              ></textarea>
              <button
                id="copy-btn"
                class="absolute top-3 right-3 bg-gray-600 hover:bg-gray-500 text-white text-xs font-bold py-1 px-2 rounded transition-colors"
              >
                复制
              </button>
            </div>
          </div>
        </div>
      </main>
    </div>

    <script>
      // --- DOM 元素获取 ---
      const markdownInput = document.getElementById("markdown-input");
      const htmlOutput = document.getElementById("html-output");
      // 新增元素
      const previewBtn = document.getElementById("preview-btn");
      const sourceBtn = document.getElementById("source-btn");
      const sourceView = document.getElementById("source-view");
      const htmlSourceOutput = document.getElementById("html-source-output");
      const copyBtn = document.getElementById("copy-btn");

      const defaultMarkdown = `
# 欢迎使用 Markdown 转换器!

这是一个实时的 Markdown 编辑器。

## 功能特性
- **实时预览**: 你输入的内容会立刻被转换。
- **源码切换**: 点击右上角的 "HTML" 标签可以查看和复制源码。
- **纯客户端**: 所有转换都在你的浏览器中完成。

### 示例

#### 列表
* 无序列表项 1
* 无序列表项 2
    * 嵌套项

1.  有序列表项 1
2.  有序列表项 2

#### 代码块
\`\`\`javascript
// 你甚至可以写代码！
function greet() {
    console.log("Hello, Markdown!");
}
greet();
\`\`\`
        `;

      // --- 函数定义 ---

      // 转换 Markdown 的函数
      function convertMarkdown() {
        const markdownText = markdownInput.value;
        const htmlText = marked.parse(markdownText);
        // 同时更新预览和源码两个区域
        htmlOutput.innerHTML = htmlText;
        htmlSourceOutput.value = htmlText;
      }

      // 更新视图（预览/源码）的函数
      function updateView(viewToShow) {
        if (viewToShow === "preview") {
          htmlOutput.classList.remove("hidden");
          sourceView.classList.add("hidden");
          previewBtn.classList.add("tab-active");
          sourceBtn.classList.remove("tab-active");
        } else {
          // 'source'
          htmlOutput.classList.add("hidden");
          sourceView.classList.remove("hidden");
          previewBtn.classList.remove("tab-active");
          sourceBtn.classList.add("tab-active");
        }
      }

      // 复制到剪贴板的函数
      function copySourceCode() {
        htmlSourceOutput.select();
        // 为了更好的兼容性，使用 document.execCommand
        document.execCommand("copy");

        // 提供视觉反馈
        const originalText = copyBtn.textContent;
        copyBtn.textContent = "已复制!";
        setTimeout(() => {
          copyBtn.textContent = originalText;
        }, 2000);
      }

      // 初始化函数
      function init() {
        markdownInput.value = defaultMarkdown.trim();
        convertMarkdown();
        updateView("preview"); // 默认显示预览

        // --- 事件监听 ---
        markdownInput.addEventListener("input", convertMarkdown);
        previewBtn.addEventListener("click", () => updateView("preview"));
        sourceBtn.addEventListener("click", () => updateView("source"));
        copyBtn.addEventListener("click", copySourceCode);
      }

      // 页面加载完成后执行初始化
      document.addEventListener("DOMContentLoaded", init);
    </script>
  </body>
</html>
